logbook-service-table:
  Type: AWS::DynamoDB::Table
  Properties:
    TableName: ${self:service}-${self:provider.stage}-table
    AttributeDefinitions:
      - AttributeName: PK # userId
        AttributeType: S
      - AttributeName: SK # example diveId
        AttributeType: S
      - AttributeName: LGBK # logbook
        AttributeType: S
      - AttributeName: company # company
        AttributeType: S
      - AttributeName: country # country
        AttributeType: S
      - AttributeName: createdAt # DateTime
        AttributeType: S
      - AttributeName: logType # DiveType or similar
        AttributeType: S
      - AttributeName: verifierId # VerifierEmail
        AttributeType: S
      - AttributeName: userVerifiedAt
        AttributeType: S
      - AttributeName: companyVerifiedAt
        AttributeType: S
      - AttributeName: clientVerifiedAt
        AttributeType: S
    KeySchema:
      - AttributeName: PK
        KeyType: HASH
      - AttributeName: SK
        KeyType: RANGE
    BillingMode: PAY_PER_REQUEST
    GlobalSecondaryIndexes:
      - IndexName: verifier-index
        KeySchema:
          - AttributeName: verifierId # logbook
            KeyType: HASH
          - AttributeName: createdAt
            KeyType: RANGE
        Projection:
          ProjectionType: ALL
      - IndexName: logbook-index
        KeySchema:
          - AttributeName: LGBK # logbook
            KeyType: HASH
          - AttributeName: createdAt
            KeyType: RANGE
        Projection:
          ProjectionType: ALL
      - IndexName: "company-index"
        KeySchema:
          - AttributeName: company
            KeyType: HASH
          - AttributeName: createdAt
            KeyType: RANGE
        Projection:
          ProjectionType: ALL
      - IndexName: "country-index"
        KeySchema:
          - AttributeName: country
            KeyType: HASH
          - AttributeName: createdAt
            KeyType: RANGE
        Projection:
          ProjectionType: ALL
      - IndexName: "entryType-index"
        KeySchema:
          - AttributeName: logType
            KeyType: HASH
          - AttributeName: createdAt
            KeyType: RANGE
        Projection:
          ProjectionType: ALL
      - IndexName: userVerifiedAtByPK-index
        KeySchema:
          - AttributeName: userVerifiedAt # userVerified
            KeyType: HASH
          - AttributeName: PK
            KeyType: RANGE
        Projection:
          ProjectionType: ALL
      - IndexName: companyVerifiedAtByPK-index
        KeySchema:
          - AttributeName: companyVerifiedAt # companyVerified
            KeyType: HASH
          - AttributeName: PK
            KeyType: RANGE
        Projection:
          ProjectionType: ALL
      - IndexName: clientVerifiedAtByPK-index
        KeySchema:
          - AttributeName: clientVerifiedAt # clientVerified
            KeyType: HASH
          - AttributeName: PK
            KeyType: RANGE
        Projection:
          ProjectionType: ALL
    Tags:
      - Key: Name
        Value: logbook service table
      - Key: createdBy
        Value: "Sean Knowles"
